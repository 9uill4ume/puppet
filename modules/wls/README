# weblogic puppet module 
# installs weblogic on linux and window based systems with 64 or 32 bits JDK
# just add the weblogic generic jar to the files folder of the wls module
#  
weblogic puppet module
  installs weblogic
  configure + starts nodemanager
  domain creation
  start the AdminServer for configuration 
  apply bsu patch


# use it like this in site.pp

include wls

$defaultJDK     = '7u7'
$defaultFullJDK = 'jdk1.7.0_07'

  
  case $operatingsystem {
     centos, redhat, OracleLinux, ubuntu, debian: { 
       $osWlHome     = "/opt/oracle/wls/wls12c/wlserver_12.1"
       $osTemplate   = "/common/templates/domains/wls.jar"
       $osDomainPath = "/opt/oracle/wls/wls12c/admin"
       $user         = "oracle"
       $group        = "dba"
     }
     windows: { 
       $osWlHome     = "c:/oracle/wls/wls12c/wlserver_12.1"
       $osTemplate   = "/common/templates/domains/wls.jar"
       $osDomainPath = "c:/oracle/wls/wls12c/admin"
       $user         = "Administrator"
       $group        = "Administrators"
       $serviceName  = "C_oracle_wls_wls12c_wlserver_12.1"
     }
  }

  # set the defaults
  Wls::Installwls {
    version      => '1211',
    versionJdk   => $defaultJDK,
    user         => $user,
    group        => $group,    
  }
  Wls::Wlsdomain {
    wlHome       => $osWlHome,
    fullJDKName  => $defaultFullJDK,	
    user         => $user,
    group        => $group,    
  }
  Wls::Nodemanager {
    wlHome       => $osWlHome,
    fullJDKName  => $defaultFullJDK,	
    user         => $user,
    group        => $group,
    serviceName  => $serviceName,  
  }
  
  # install
  wls::installwls{'wls12c':
    require      => Jdk7::Install7['jdk7'],
  }

  wls::wlsdomain{
  
    'testDomain':
    template     => $osTemplate,
    domain       => 'myTestDomain',
    domainPath   => $osDomainPath,
    require      => Wls::Installwls['wls12c'];

    'testDomain2':
    template        => $osTemplate,
    domain          => 'myTestDomain2',
    domainPath      => $osDomainPath,
    adminListenPort => '8001',
    require         => Wls::Installwls['wls12c'];
    
  }

  #nodemanager configuration and starting
  wls::nodemanager{'nodemanager':
    require      => [Wls::Wlsdomain['testDomain'],Wls::Wlsdomain['testDomain2']],
  }

  # default parameters for the wlst scripts
  Wls::Wlstexec {
    wlHome       => $osWlHome,
    fullJDKName  => $defaultFullJDK,	
    user         => $user,
    group        => $group,
    address      => "localhost",
    wlsUser      => "weblogic",
    password     => "weblogic1",
  }
  
  # start AdminServers for configuration of both domains myTestDomain
  wls::wlstexec { 
  
    'startAdminServer':
     id          => 'unique1',
     script      => 'startWlsServer.py',
     port        => '5556',
     params      =>  ["domain = 'myTestDomain'",
                      "domainPath = '${osDomainPath}/myTestDomain'",
                      "wlsServer = 'AdminServer'"],
     require     => Wls::Nodemanager['nodemanager'];

    'startAdminServer2':
     id          => 'unique2',
     script      => 'startWlsServer.py',
     port        => '5556',
     params      =>  ["domain = 'myTestDomain2'",
                      "domainPath = '${osDomainPath}/myTestDomain2'",
                      "wlsServer = 'AdminServer'"],
     require     => Wls::Nodemanager['nodemanager'];

  }
  
  
  wls::bsupatch{'p13573621':
    mdwHome      => $osMdwHome ,
    wlHome       => $osWlHome,
    fullJDKName  => $defaultFullJDK,
    patchId      => 'KZKQ',	
    patchFile    => 'p13573621_1036_Generic.zip',	
    user         => $user,
    group        => $group, 
  }

